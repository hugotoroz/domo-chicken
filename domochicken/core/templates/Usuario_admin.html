{% extends "base/base.html" %}
{% load static %}
{% block css %}
<link rel="stylesheet" href="../static/css/style.css">
{% endblock %}
{% block title %}Domo Chicken - La mejor calidad{% endblock %}
{% block template %}
<div class="container">
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Apellido</th>
                    <th>Correo</th>
                    <th>Tipo de usuario</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody>
                {% for x in usuarios %}
                <tr>
                    <td>{{ x.nombre_usuario }}</td>
                    <td>{{ x.apellido_usuario }}</td>
                    <td>{{ x.correo }}</td>
                    <td>{{ x.fk_id_rol.nombre_rol }}</td> <!-- CORREGIDO -->
                    {% if x.u_is_active == 1 %}
                    <td>Activo</td>
                    {% endif %}
                    {% if x.u_is_active == 0 %}
                    <td>Desactivado</td>
                    {% endif %}
                    {% if x.u_is_active == 1 %}
                    <td><button href="" data-estado="{{x.id_usuario}}" type="button" class="boton btn-abrir-modal">
                            Desactivar
                        </button></td>
                    {% endif %}
                    {% if x.u_is_active == 0 %}
                    <td><button href="" data-estado="{{x.id_usuario}}" type="button"
                            class="boton btn-abrir-modal-activar">
                            Activar
                        </button></td>
                    {% endif %}
                    {% if x.row_status == 1 %}
                    <td><button href="" data-estado="{{x.id_usuario}}" type="button"
                            class="boton btn-abrir-modal-eliminar">
                            Eliminar
                        </button></td>
                    {% endif %}
                    <td>
                        <button href="" data-usuario="{{x.id_usuario}}" type="button" class="boton btn-abrir-modal-rol">
                            Modificar Rol 
                        </button>
                    </td>
                    <!-- MODAL PARA MODIFICAR ROL USUARIO-->
                    <div id="modalRol" class="modal">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <!-- Contenido de la modal -->
                                <div class="modal-header">
                                    <h5 class="modal-title">Modificar rol usuario</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <p>Selecciona un rol </p>
                                </div>
                                <select name="roles" id="roles" class="form-select" required>
                                    <option disabled value="">Seleccione un rol</option>
                                    {% for rol in roles %}
                                    {% if rol.id_rol == x.fk_id_rol_id %}
                                    <option value="{{ x.fk_id_rol_id }}" selected>{{ x.fk_id_rol.nombre_rol }}</option>
                                    {% else %}
                                    <option value="{{ rol.id_rol}}">{{ rol.nombre_rol }}</option>
                                    {% endif %}
                                    {% endfor %}
                                </select>
                                <div class="modal-body">
                                    <p>Estas seguro de que quieres cambiar el rol a este usuario?</p>
                                </div>
                                <div class="modal-footer">
                                    <span id="grupo-id"></span>
                                    <button type="button" class="btn btn-secondary close"
                                        data-dismiss="modal">Cerrar</button>
                                    <a href="#" class="btn btn-danger" id="btn-salir-rol">Aceptar</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </tr>
                
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<!-- MODAL PARA DESACTIVAR USUARIO-->
<div id="myModal" class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Contenido de la modal -->
            <div class="modal-header">
                <h5 class="modal-title">Desactivar usuario</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Estas seguro de que quieres desactivar a este usuario?</p>
            </div>
            <div class="modal-footer">
                <span id="grupo-id"></span>
                <button type="button" class="btn btn-secondary close" data-dismiss="modal">Cerrar</button>
                <a href="#" class="btn btn-danger" id="btn-salir">Salir</a>
            </div>
        </div>
    </div>
</div>
<!-- MODAL PARA ACTIVAR USUARIO-->
<div id="myModal2" class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Contenido de la modal -->
            <div class="modal-header">
                <h5 class="modal-title">Activar usuario</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Estas seguro de que quieres activar a este usuario?</p>
            </div>
            <div class="modal-footer">
                <span id="grupo-id"></span>
                <button type="button" class="btn btn-secondary close" data-dismiss="modal">Cerrar</button>
                <a href="#" class="btn btn-danger" id="btn-activar">Aceptar</a>
            </div>
        </div>
    </div>
</div>
<!-- MODAL PARA ELIMINAR USUARIO-->
<div id="myModal3" class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Contenido de la modal -->
            <div class="modal-header">
                <h5 class="modal-title">Eliminar usuario</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Estas seguro de que quieres eliminar a este usuario?</p>
            </div>
            <div class="modal-footer">
                <span id="grupo-id"></span>
                <button type="button" class="btn btn-secondary close" data-dismiss="modal">Cerrar</button>
                <a href="#" class="btn btn-danger" id="btn-eliminar">Aceptar</a>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        //MODAL DE DESACTIVAR
        $(".btn-abrir-modal").click(function () {
            // Mostrar la modal correspondiente al botón de eliminar
            $("#myModal").modal("show");
        });
        $(".btn-abrir-modal").click(function () {
            var estado = $(this).data("estado");
            var desactivar = "/desactivar_usuario/" + estado + "/";
            $("#btn-salir").attr("href", desactivar);
        });
        $(".close").click(function () {
            // Mostrar la modal correspondiente al botón de eliminar
            $("#myModal").modal("hide");
        });
        //MODAL DE ACTIVAR
        $(".btn-abrir-modal-activar").click(function () {
            // Mostrar la modal correspondiente al botón de eliminar
            $("#myModal2").modal("show");
        });
        $(".btn-abrir-modal-activar").click(function () {
            var estado = $(this).data("estado");
            var activar = "/activar_usuario/" + estado + "/";
            $("#btn-activar").attr("href", activar);
        });
        //MODAL DE ELIMINAR
        $(".close").click(function () {
            // Mostrar la modal correspondiente al botón de eliminar
            $("#myModal2").modal("hide");
        });
        $(".btn-abrir-modal-eliminar").click(function () {
            // Mostrar la modal correspondiente al botón de eliminar
            $("#myModal3").modal("show");
        });
        $(".btn-abrir-modal-eliminar").click(function () {
            var estado = $(this).data("estado");
            var activar = "/eliminar_usuario/" + estado + "/";
            $("#btn-eliminar").attr("href", activar);
        });
        $(".close").click(function () {
            // Mostrar la modal correspondiente al botón de eliminar
            $("#myModal3").modal("hide");
        });
        //Modal para modificar el rol
        $(".btn-abrir-modal-rol").click(function () {
            // Mostrar la modal correspondiente al botón de rol
            $("#modalRol").modal("show");
        });
        $(".btn-abrir-modal-rol").click(function () {
            var usuario = $(this).data("usuario");
            $("#roles").change(function () {
            // Obtener el valor seleccionado
            var selectedValue = $(this).val();
            console.log(usuario)
            var cambiar = "/modificarRol/" + selectedValue + "/" + usuario + "/";
            $("#btn-salir-rol").attr("href", cambiar);
            }); 
            
            
        });
        $(".close").click(function () {
            // Mostrar la modal correspondiente al botón de eliminar
            $("#modalRol").modal("hide");
        });
    });
</script>

{% endblock %}